// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Admin User Model
model Admin {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  email     String   @unique
  password  String   // Hashed password
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("admins")
}

// Banner Model
model Banner {
  id          Int      @id @default(autoincrement())
  image       String   // Image URL or path
  type        String   @default("normal") // "normal" or "movie"
  movieId     Int?     // If type is "movie", reference to movie ID
  title       String?  // Optional title for the banner
  description String? // Optional description
  link        String?  // Optional link URL
  order       Int      @default(0) // Display order
  isActive    Boolean  @default(true)
  startDate   DateTime? // Optional start date for scheduling
  endDate     DateTime? // Optional end date
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("banners")
}

// Experience Model
model Experience {
  id            Int      @id @default(autoincrement())
  image         String   // Image URL
  fallbackImage String?  // Fallback image URL
  title         String
  description   String   @db.Text
  order         Int      @default(0)
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("experiences")
}

// Promotion Model
model Promotion {
  id          Int      @id @default(autoincrement())
  image       String   // Image URL
  title       String?
  description String?  @db.Text
  link        String?  // Optional link
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("promotions")
}

// About Page Content Model
model AboutContent {
  id          Int      @id @default(autoincrement())
  section     String   @unique // e.g., "hero", "mission", "vision", "contact", "info"
  title       String?
  content     String   @db.Text // HTML or markdown content
  image       String?  // Optional image URL
  order       Int      @default(0) // Display order
  isActive    Boolean  @default(true)
  width       String?  // Optional: "full", "half", etc.
  layout      String?  // Optional: "text-left", "text-right"
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("about_content")
}

// Dynamic Pages Model (Privacy Policy, Terms, etc.)
model Page {
  id          Int      @id @default(autoincrement())
  slug        String   @unique  // URL slug, e.g., "privacy-policy"
  title       String
  content     String   @db.Text // HTML content
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("pages")
}

// Contact Information
model ContactInfo {
  id          Int      @id @default(autoincrement())
  type        String   @unique // e.g., "phone", "email", "address"
  title       String
  value       String
  icon        String?  // Icon name
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  
  @@map("contact_info")
}

// Order/Booking Model
model Order {
  id            Int      @id @default(autoincrement())
  orderId       String?  @unique // Payment Gateway Order ID (MS...)
  referenceNo   String  @unique // Booking Reference Number (B1A...) - Ticket Ref
  transactionNo String?  // Payment Transaction ID
  customerName  String?
  customerEmail String?
  customerPhone String?
  
  // Movie Details
  movieId       Int?     // Optional link if we track movies locally later
  movieTitle    String
  cinemaName    String?
  cinemaId      String?
  hallName      String?
  showId        String?
  showTime      DateTime? // Date and time of the show
  
  // Booking Details
  seats         String   // Stored as comma-separated string or JSON text e.g. "A1, A2"
  ticketType    String?  // e.g. "Adult, Child"
  totalAmount   Decimal  @default(0.00) @db.Decimal(10, 2)
  
  // Statuses
  status        String   @default("CONFIRMED") // CONFIRMED, CANCELLED, PENDING
  paymentStatus String   @default("PAID")      // PAID, PENDING, FAILED, REFUNDED
  paymentMethod String?  // e.g. "Credit Card", "FPX", "Cash"
  
  // Email Tracking
  emailInfo     Json?    // Store email data JSON
  isSendMail    Boolean  @default(false)

  // New flags
  token         String?
  reserve_ticket Boolean @default(false)
  cancel_ticket Boolean @default(false)
  refund        Boolean?
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt


  @@map("orders")
}

// Contact messages submitted from the contact page
model ContactMessage {
  id        Int      @id @default(autoincrement())
  name      String
  email     String
  phone     String?
  subject   String
  message   String   @db.Text
  createdAt DateTime @default(now())
  
  @@map("contact_messages")
}

// Global System Settings (Key-Value)
model Setting {
  id        Int      @id @default(autoincrement())
  key       String   @unique
  value     String
  updatedAt DateTime @updatedAt
  
  @@map("settings")
}

// Payment Transaction Logs
model PaymentLog {
  id            Int      @id @default(autoincrement())
  orderId       String?  // Payment Gateway Order ID
  referenceNo   String?  // Internal Booking Reference
  transactionNo String?  // Payment Gateway Transaction ID
  
  // Payment Details
  status        String?  // Return status code (e.g., 00, 11, -1)
  amount        Decimal? @db.Decimal(10, 2)
  currency      String?
  channel       String?  // Payment channel (credit, fpx, etc.)
  
  // Request context
  method        String?  // GET or POST
  ipAddress     String?
  userAgent     String?
  
  // Detailed Data
  returnData    Json?    // Full return data from MolPay
  
  // Outcome Analysis
  isSuccess     Boolean  @default(false) // Did our system consider it a success?
  remarks       String?  @db.Text        // Explanation (why success/fail)
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([orderId])
  @@index([referenceNo])
  @@index([transactionNo])
  @@map("payment_logs")
}
